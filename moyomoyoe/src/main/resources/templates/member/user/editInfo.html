<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EDITINFO</title>
    <style>
        #upload-file-button {
            background-color: #CAEEE7;
            border: 1px solid #6BAFA2;
            border-radius: 10px;
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 5px;
            padding-bottom: 5px;
        }

        #upload-file-button:hover {
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>회원 정보 수정</h1>

<h3>프로필 사진 첨부 - 웨않되</h3>

<div th:if="${ img != null }">
    <img th:src="${ img }" alt="업로드 파일" width="100" height="100">
</div>
<form th:action="@{/member/user/updateInfo}" method="POST" id="updateInfo" enctype="multipart/form-data">
    파일 : <input type="file" name="singleFile"><br>
    <hr>
    이름 : <span th:text="${ user.name }"></span><br>
    아이디 : <span th:text="${ user.account }"></span><br>
    비밀번호 : <input type="password" id="password" name="password" required><br>
    비밀번호 확인 : <input type="password" id="checkPwd" name="checkPwd" required><br>
    <span id="errorMsg2" style="color: tomato; display: none"><small>비밀번호가 일치하지 않습니다.</small></span>
    <span id="errorMsg4" style="color: forestgreen; display: none"><small>비밀번호 일치 확인</small></span>
    닉네임 : <input type="text" id="nickname" name="nickname" required><br>
    지역 : <span th:text="${ user.region }"></span><br>
    연락처 : <input type="text" id="signUpPhoneNum1" name="phone" size="3" required>
    -
    <input type="text" id="signUpPhoneNum2" name="phone" size="4" required>
    -
    <input type="text" id="signUpPhoneNum3" name="phone" size="4" required><br>
    이메일 : <input type="text" id="signupEmailLocal" name="email" required>
    @
    <select id="signupEmailDomain" name="email" required>
        <option value="naver.com">naver.com</option>
        <option value="gmail.com">gmail.com</option>
        <option value="daum.net">daum.net</option>
    </select><br>
    <br>
    <button id="updateFormButton">저장</button>
</form>


<script>
    const password = document.getElementById('password');
    const checkPwd = document.getElementById('checkPwd');
    const errorMsg2 = document.getElementById('errorMsg2');

    document.getElementById('updateInfo').addEventListener('submit', function(event) {

        console.log('폼제출');

        if(checkPwd.value !== password.value) {
            event.preventDefault();
            alert('비밀번호가 일치하지 않습니다.');
            console.log('비밀번호 불일치');
            return;
        } else {
            // this.submit();
            console.log('비밀번호 일치 제출 완');
        }
    });

    document.getElementById('checkPwd').addEventListener('input', function(event) {

        if(checkPwd.value !== password.value) {
            event.preventDefault();
            errorMsg2.style.display = 'block';
            errorMsg4.style.display = 'none';
            console.log('다름');
        } else {
            errorMsg2.style.display = 'none';
            errorMsg4.style.display = 'block';
            console.log('일치');
        }
    });

    document.getElementById('signupEmailLocal').addEventListener('input', function () {
        const local = document.getElementById('signupEmailLocal').value;
        const domain = document.getElementById('signupEmailDomain').value;
        const email = `${local}@${domain}`;	// 합쳐서 이메일 완성 챠란~!

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
        if (emailRegex.test(email)) {
            console.log(`Valid Email : ${email}`);
        } else {
            console.log(`Invalid Email Format`)
        }
    });

    document.getElementById('updateInfo').addEventListener('submit', function (e) {
        // e.preventDefault();

        const id = document.getElementById('account').value;
        const password = document.getElementById('password').value;

        // 한글 포함 여부 검사
        const KoreanRegex = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;
        if (KoreanRegex.test(password)) {
            alert('비밀번호에는 한글을 입력할 수 없습니다.');
            e.preventDefault();
            return;
        } else {
            // this.submit();
        }

        const pwdRegex = /^(?=.*[a-z])(?=.*\d)(?=.*[@!$%*&?])[a-z\d@!$%*&?]{8,}$/;
        if (!pwdRegex.test(password)) {
            alert('비밀번호는 소문자, 숫자, 특수문자를 포함하여 최소 8자리 이상으로 입력해주세요.');
            e.preventDefault();
            return;
        } else {
            // this.submit();
        }

        const firstNum = document.getElementById('signUpPhoneNum1').value;
        const midNum = document.getElementById('signUpPhoneNum2').value;
        const lastNum = document.getElementById('signUpPhoneNum3').value;
        const phone = `${firstNum}-${midNum}-${lastNum}`;

        const phoneNumRegex = /^\d{3}-\d{3,4}-\d{4}$/;
        if (!phoneNumRegex.test(phone)) {
            alert('올바른 휴대전화번호를 입력해주세요.');
            e.preventDefault();
            return;
        } else {
            console.log('phone');
            // this.submit();
        }
    });

</script>

</body>
</html>