<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
registstore
<form id="storeForm" th:action="@{/reservation/schedule/regist/store}" th:object="${store}" method="post">
    <div>
        <img th:src="${ img }" alt="업로드 파일" width="100" height="100">
        파일 : <input type="file" name="singleFile"><br>
        <label for="storeId" > 상가 번호 </label>
        <input type="hidden" id="storeId" th:field="*{storeId}">
        <label for="name">상호명 :</label>
        <input type="text" id="name" th:field="*{storeName}" required />
        <br>
        <label for="name">주소 :</label>
        <input type="text" id="address" th:field="*{storeAddress}">
        <br>
        <label for="name">설명 :</label>
        <input type="text" id="description" th:field="*{description}">
        <select type="text" id="storeSort" th:field="*{storeSort}">
            <option value="기타" >기타</option>
            <option value="음식" >음식</option>
        </select>
        <label for="businessNo"> 등록번호</label>
        <input type="text" id="businessNo" th:field="*{businessNo}">
        <input hidden="hidden"  id="userId" th:field="*{userId}">

    </div>
    <div>
        <label></label>
    </div>

    <button id="submit"> 등록</button>
    <a href="/"> 메인으로</a>
    <button onclick="deleteFetch()" class="a-button-warning right-align">사업장 삭제</button>

</form>
</body>
<script th:inline="javascript">
    const userId = /*[[${userId}]]*/ 0;

    document.getElementById("storeForm").addEventListener("submit", function(event) {
        event.preventDefault(); // 기본 제출 이벤트 방지

        const formData = new FormData(this); // 현재 폼의 데이터를 FormData로 생성

        // FormData를 JSON 객체로 변환
        const data = Object.fromEntries(formData.entries());
        const userId =  formData.get('userId');
        console.log(userId)
        fetch("")

        fetch("/reservation/schedule/regist/store", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data), // JSON 형식으로 변환하여 전송
        })
            .then(response => {
                console.log(response)
                return response.json()
            }).then(data=>{
            if(data.status == "success"){
                console.log(userId)
                alert("일정 수정 성공")

                location.href=`/reservation/schedule/storeInfo/${userId}`
            }else{
                alert("일정 수정에 실패했습니다. 다시 시도해주세요.")
            }
            })
            .catch(error => {
                console.error("Error:", error); // 오류 로그
                alert("전송 중 오류가 발생했습니다."); // 오류 메시지 표시
            });
    });
    function deleteFetch(){
        if (
            confirm("사업장 정보를 삭제하시겠습니까? 현재 들어온 예약과 등록된 일정을 포함한 정보가 모두 삭제됩니다.")
        ) {
            fetch(`/reservation/schedule/delete/store/${userId}`).
            then(response => response.json()).then(
                data=>{
                    if(data.status == "success"){
                        location.href=`/reservation/schedule/regist/store/${userId}`
                    }else {
                        alert("사업장 삭제에 실패했습니다. 다시 시도해주세요.")
                    }
                }
            );
        }
    }

</script>
</html>